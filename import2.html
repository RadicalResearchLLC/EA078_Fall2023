<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Environmental Data Visualization - 12&nbsp; Importing Data - Part 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./export.html" rel="next">
<link href="./data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data.html">Unit 3: Data</a></li><li class="breadcrumb-item"><a href="./import2.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Importing Data - Part 1</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Environmental Data Visualization</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introductions</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./weather.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 1: Weather and Climate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Fundamentals of Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coding1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding in R - Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to Spatial Visualization - 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./maps2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Spatial Visualization 2</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chartJunk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chartjunk, Data-Ink Ratios, and Visualization Theory</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Assignments for Unit 1</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./EJ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 2: Environmental Justice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EJtheory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">EJ - Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EJtools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">EJ - Praxis and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./EJdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">EJ - Exploratory Analysis Case Study</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Central.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">EJ - Warehouse Mapping Case Study - Warehouse CENTRAL</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Assignments for Unit 2 - EJ</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unit 3: Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Importing Data - Part 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./export.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exporting Visualizations and Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./munging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Data Science 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./import3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Importing Data - Part 2</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Course Syllabus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R and RStudio Installation and Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Resources</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Debugging Steps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#load-and-install-packages" id="toc-load-and-install-packages" class="nav-link active" data-scroll-target="#load-and-install-packages"><span class="header-section-number">12.1</span> Load and Install Packages</a></li>
  <li>
<a href="#option-1.-point-and-click-download-file-save-read" id="toc-option-1.-point-and-click-download-file-save-read" class="nav-link" data-scroll-target="#option-1.-point-and-click-download-file-save-read"><span class="header-section-number">12.2</span> Option 1. Point and Click Download, File Save, Read</a>
  <ul>
<li><a href="#find-and-download-data" id="toc-find-and-download-data" class="nav-link" data-scroll-target="#find-and-download-data"><span class="header-section-number">12.2.1</span> Find and Download Data</a></li>
  <li><a href="#move-the-zipped-shapefile-to-the-r-working-directory" id="toc-move-the-zipped-shapefile-to-the-r-working-directory" class="nav-link" data-scroll-target="#move-the-zipped-shapefile-to-the-r-working-directory"><span class="header-section-number">12.2.2</span> Move the Zipped Shapefile to the R Working Directory</a></li>
  <li>
<a href="#unzip-the-data---two-ways" id="toc-unzip-the-data---two-ways" class="nav-link" data-scroll-target="#unzip-the-data---two-ways"><span class="header-section-number">12.2.3</span> Unzip the data - Two Ways</a>
  <ul class="collapse">
<li><a href="#point-and-click-unzip" id="toc-point-and-click-unzip" class="nav-link" data-scroll-target="#point-and-click-unzip"><span class="header-section-number">12.2.3.1</span> Point and Click Unzip</a></li>
  <li><a href="#unzip-with-code" id="toc-unzip-with-code" class="nav-link" data-scroll-target="#unzip-with-code"><span class="header-section-number">12.2.3.2</span> Unzip with Code</a></li>
  </ul>
</li>
  <li><a href="#visualize-the-data" id="toc-visualize-the-data" class="nav-link" data-scroll-target="#visualize-the-data"><span class="header-section-number">12.2.4</span> Visualize the data</a></li>
  <li><a href="#option-2---directly-read-the-dataset" id="toc-option-2---directly-read-the-dataset" class="nav-link" data-scroll-target="#option-2---directly-read-the-dataset"><span class="header-section-number">12.2.5</span> Option 2 - Directly Read the Dataset</a></li>
  <li><a href="#advanced-data-visualization" id="toc-advanced-data-visualization" class="nav-link" data-scroll-target="#advanced-data-visualization"><span class="header-section-number">12.2.6</span> Advanced data visualization</a></li>
  <li><a href="#downloading-secured-zip-files" id="toc-downloading-secured-zip-files" class="nav-link" data-scroll-target="#downloading-secured-zip-files"><span class="header-section-number">12.2.7</span> Downloading secured zip files</a></li>
  </ul>
</li>
  <li><a href="#exercise-1." id="toc-exercise-1." class="nav-link" data-scroll-target="#exercise-1."><span class="header-section-number">12.3</span> Exercise 1.</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-import2" class="quarto-section-identifier"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Importing Data - Part 1</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Today we will focus on the practice of importing data - better than last time.</p>
</div>
</div>
</div>
<p>Our framework for the workflow of data visualization is shown in <a href="#fig-TidyverseFramework">Figure&nbsp;<span>12.1</span></a></p>
<div id="fig-TidyverseFramework" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="https://d33wubrfki0l68.cloudfront.net/795c039ba2520455d833b4034befc8cf360a70ba/558a5/diagrams/data-science-explore.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12.1: Tidyverse framework again</figcaption></figure>
</div>
<p>Acquiring and importing data is the most complicated part of this course and data visualization in general. This Unit is done now, rather than at the beginning, because of its difficulty and pain - while providing little immediate satisfaction of a cool map or graphic. In my experience, data import and manipulation is 80+% of the work when creating visualizations; it needs to be covered at least nominally in any course on data visualization.</p>
<section id="load-and-install-packages" class="level2" data-number="12.1"><h2 data-number="12.1" class="anchored" data-anchor-id="load-and-install-packages">
<span class="header-section-number">12.1</span> Load and Install Packages</h2>
<p>As always, we should load the packages we need to import the data. There are many specialized data import packages, but <code>tidyverse</code> and <code>sf</code> are a good start and can handle many standard tables and geospatial data files. Remember, you can check to make sure a package is loaded in your R session by checking on the <em>files, plots, and packages</em> panel, clicking on the <em>Packages</em> tab, and scrolling down to <code>tidyverse</code> and <code>sf</code> to make sure they are checked.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.2, GDAL 3.6.2, PROJ 9.2.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="option-1.-point-and-click-download-file-save-read" class="level2" data-number="12.2"><h2 data-number="12.2" class="anchored" data-anchor-id="option-1.-point-and-click-download-file-save-read">
<span class="header-section-number">12.2</span> Option 1. Point and Click Download, File Save, Read</h2>
<p>The basic way to acquire data is the Point and Click method. This is a step-by-step instruction for doing that.</p>
<section id="find-and-download-data" class="level3" data-number="12.2.1"><h3 data-number="12.2.1" class="anchored" data-anchor-id="find-and-download-data">
<span class="header-section-number">12.2.1</span> Find and Download Data</h3>
<p>Go to <a href="https://oehha.ca.gov/calenviroscreen/report/calenviroscreen-40">CalEnviroScreen</a></p>
<p>Download the <em>Zipped Shapefile</em> shown in the screenshot in <a href="#fig-download">Figure&nbsp;<span>12.2</span></a></p>
<div id="fig-download" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src=".\images/CalEJScreen_download.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12.2: CalEnviroScreen Shapefile Location</figcaption></figure>
</div>
<p>By default, downloads are often placed in a <strong>Downloads</strong> directory, although you may have changed that on your local machine.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>You can skip the next step if you directly save the zip file to your working directory.</p>
</div>
</div>
</div>
</section><section id="move-the-zipped-shapefile-to-the-r-working-directory" class="level3" data-number="12.2.2"><h3 data-number="12.2.2" class="anchored" data-anchor-id="move-the-zipped-shapefile-to-the-r-working-directory">
<span class="header-section-number">12.2.2</span> Move the Zipped Shapefile to the R Working Directory</h3>
<p>By default, downloads are often placed in a <strong>Downloads</strong> directory, although you may have changed that on your local machine. If this occurred in your download, the zipped needs to be either (a) moved to the R working directory or (b) identify the filepath of the default download directory and work with it from there.</p>
<p>For today, I will only show path (a) because it is good data science practice to keep the data in a directory associated with the visualization.</p>
<ol type="1">
<li>Identify the directory where the zipped shapefile was downloaded. On my machine, this is a <strong>Downloads</strong> folder which can be accessed through my web browser after the file download is complete; <a href="#fig-openFolder">Figure&nbsp;<span>12.3</span></a> shows an example. The name of the file is <strong>calenviroscreen40shpf2021shp.zip</strong>.</li>
</ol>
<div id="fig-openFolder" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src=".\images/download_complete.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12.3: Browser download</figcaption></figure>
</div>
<ol start="2" type="1">
<li>Identify the R working directory on your machine using the <code><a href="https://rdrr.io/r/base/getwd.html">getwd()</a></code> function.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/Dev/EA078_Fall2023"</code></pre>
</div>
</div>
<ol start="3" type="1">
<li><p>Move <strong>calenviroscreen40shpf2021shp.zip</strong> from the default download directory to the R working directory. Either drag it, copy and paste it, or cut and paste it. For Macs - use the <a href="https://support.apple.com/en-us/HT201732">Finder</a> tool. For PCs, use <a href="https://support.microsoft.com/en-us/windows/find-and-open-file-explorer-ef370130-1cca-9dc5-e0df-2f7416fe1cb1">File Explorer</a>.</p></li>
<li><p>Check your <em>Files, Plots, and Packages</em> panel to see the zipped file is identified by RStudio. See the example in <a href="#fig-filesPanel">Figure&nbsp;<span>12.4</span></a>.</p></li>
</ol>
<div id="fig-filesPanel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src=".\images/inDirectory.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12.4: Files, Plots, and Packages Panel</figcaption></figure>
</div>
<p>If you see the <strong>calenviroscreen40shpf2021shp.zip</strong> in the directory on your machine, congratulations! You are a winner!</p>
</section><section id="unzip-the-data---two-ways" class="level3" data-number="12.2.3"><h3 data-number="12.2.3" class="anchored" data-anchor-id="unzip-the-data---two-ways">
<span class="header-section-number">12.2.3</span> Unzip the data - Two Ways</h3>
<p>Although the data is in the right place, it is not directly readable while zipped.</p>
<section id="point-and-click-unzip" class="level4" data-number="12.2.3.1"><h4 data-number="12.2.3.1" class="anchored" data-anchor-id="point-and-click-unzip">
<span class="header-section-number">12.2.3.1</span> Point and Click Unzip</h4>
<p>I think the process is basically the same for Mac and PC, but we will identify this in class.</p>
<ul>
<li><p>On a Mac, <a href="https://support.apple.com/guide/mac-help/zip-and-unzip-files-and-folders-on-mac-mchlp2528/mac">Double-click the .zip file</a>. The unzipped item appears in the same folder as the .zip file.</p></li>
<li><p>On a PC, right-clicking on a zipped file will bring up a menu that includes an <strong>Extract All</strong> option. Choosing the <strong>Extract All</strong> option brings up a pathname to extract the file to. The default is to extract the zip file to a subfolder named after the zip file.</p></li>
</ul>
<p>Again, go to the <em>Files, Plots, and Packages</em> panel and check if there is a folder called <strong>calenviroscreen40shpf2021shp</strong> as shown in <a href="#fig-panel2">Figure&nbsp;<span>12.5</span></a></p>
<div id="fig-panel2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src=".\images/folder.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12.5: Shapefile folder is in the working directory!</figcaption></figure>
</div>
</section><section id="unzip-with-code" class="level4" data-number="12.2.3.2"><h4 data-number="12.2.3.2" class="anchored" data-anchor-id="unzip-with-code">
<span class="header-section-number">12.2.3.2</span> Unzip with Code</h4>
<p>Same idea. Use the <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function to unzip the zipped shapefile folder. We will save it in a separate directory to test if this way works independently of point and click method. The <code><a href="https://rdrr.io/r/utils/unzip.html">unzip()</a></code> function needs two arguments - the path of the <code>zipfile =</code>, and the export directory name <code>exdir =</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">directory</span> <span class="op">&lt;-</span> <span class="st">'CalEJ4'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span><span class="op">(</span>zipfile <span class="op">=</span> <span class="st">'calenviroscreen40shpf2021shp.zip'</span>, exdir <span class="op">=</span> <span class="va">directory</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in unzip(zipfile = "calenviroscreen40shpf2021shp.zip", exdir =
directory): error 1 in extracting from zip file</code></pre>
</div>
</div>
<p>Check the <em>Files</em> panel. Check for a new <strong>CalEJ4</strong> folder; <span class="quarto-unresolved-ref">?fig-panel3</span> shows how it looks on my machine.</p>
<p><img src=".\images/double.png" id="fig-panel3" class="img-fluid" alt="Another folder is in the working directory!"> ### Import the Shapefile</p>
<p>The <code>sf</code> library is used to import geospatial data. The <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> is great at read and identifying the type of spatial file.</p>
<p>Shapefiles are the <a href="https://www.esri.com/en-us/home"><strong>esri</strong></a> propietary geospatial format and are very common.</p>
<p>The CalEnviroScreen data are in the shapefile format, which is a bunch of individual files organized in a folder directory. In the <strong>calenviroscreen40shpf2021shp</strong> directory, there are 8 individual files with 8 different file extensions. We can ignore that and just point <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code> at the directory and it will do the rest. The <code>dsn =</code> argument stands for <em>data source name</em> which can be a directory, file, or a database.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CalEJ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="va">directory</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the <em>Environment</em> panel after running this line of code. Is there a CalEJ file with 8035 observations of 67 variables present?</p>
<p>If so, success is yours! Let’s make a map of Pesticide census tract percentiles to celebrate with <span class="quarto-unresolved-ref">?fig-CaliforniaPesticide</span>!</p>
</section></section><section id="visualize-the-data" class="level3" data-number="12.2.4"><h3 data-number="12.2.4" class="anchored" data-anchor-id="visualize-the-data">
<span class="header-section-number">12.2.4</span> Visualize the data</h3>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CalEJ</span> <span class="op">&lt;-</span> <span class="va">CalEJ</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PesticideP</span> <span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="st">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">palPest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">'Reds'</span>, domain <span class="op">=</span> <span class="va">CalEJ</span><span class="op">$</span><span class="va">PesticideP</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CalEJ</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span><span class="op">(</span>color <span class="op">=</span> <span class="op">~</span><span class="fu">palPest</span><span class="op">(</span><span class="va">PesticideP</span><span class="op">)</span>,</span>
<span>                fillOpacity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                label <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/htmlEscape.html">htmlEscape</a></span><span class="op">(</span><span class="va">ApproxLoc</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">palPest</span>,</span>
<span>              title <span class="op">=</span> <span class="st">'Pesticide (%)'</span>, </span>
<span>              values <span class="op">=</span> <span class="op">~</span><span class="va">PesticideP</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="option-2---directly-read-the-dataset" class="level3" data-number="12.2.5"><h3 data-number="12.2.5" class="anchored" data-anchor-id="option-2---directly-read-the-dataset">
<span class="header-section-number">12.2.5</span> Option 2 - Directly Read the Dataset</h3>
<p><a href="https://gml.noaa.gov/dv/data/index.php?category=Greenhouse%2BGases&amp;parameter_name=Methane&amp;frequency=Monthly%2BAverages&amp;type=Flask">Methane monthly average concentrations sampled by flasks</a></p>
<p>Today I am selecting Mauna Loa (MLO) in Hawaii. Methane’s chemical formula is CH<sub>4</sub>. Therefore, I will assign the path of URL.MLO.CH4</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">URL.MLO.CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span> <span class="st">'https://gml.noaa.gov/aftp/data/trace_gases/ch4/flask/surface/txt/ch4_mlo_surface-flask_1_ccgg_month.txt'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We did this before for Alert, let’s try the successful code using the <code><a href="https://readr.tidyverse.org/reference/read_table.html">read_table()</a></code> function. Note, that when I follow the link, the first line of the dataset says there are <strong>71 header lines</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MLO.CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html">read_table</a></span><span class="op">(</span><span class="va">URL.MLO.CH4</span>, skip <span class="op">=</span> <span class="fl">71</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  MLO = col_character(),
  `1984` = col_double(),
  `10` = col_double(),
  `1673.77` = col_double()
)</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">MLO.CH4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  MLO   `1984`  `10` `1673.77`
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
1 MLO     1984    11     1676.
2 MLO     1984    12     1671.
3 MLO     1985     1     1662.
4 MLO     1985     2     1665.
5 MLO     1985     3     1677.
6 MLO     1985     4     1674.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">headers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'site'</span>, <span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'value'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">MLO.CH4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">headers</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">MLO.CH4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  site   year month value
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 MLO    1984    11 1676.
2 MLO    1984    12 1671.
3 MLO    1985     1 1662.
4 MLO    1985     2 1665.
5 MLO    1985     3 1677.
6 MLO    1985     4 1674.</code></pre>
</div>
</div>
<p>This is better.</p>
<p>We can now visualize the data in <a href="#fig-MLOMethaneTrend">Figure&nbsp;<span>12.6</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MLO.CH4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>decimal.Date <span class="op">=</span> <span class="op">(</span><span class="va">year</span> <span class="op">+</span> <span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">decimal.Date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Year'</span>, y <span class="op">=</span> <span class="st">'Methane concentration (ppb)'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">'Mauna Loa - methane trend'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-MLOMethaneTrend" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="import2_files/figure-html/fig-MLOMethaneTrend-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12.6: Trend in Methane concentrations (ppb) at Mauna Loa, Hawaii</figcaption></figure>
</div>
</div>
</div>
</section><section id="advanced-data-visualization" class="level3" data-number="12.2.6"><h3 data-number="12.2.6" class="anchored" data-anchor-id="advanced-data-visualization">
<span class="header-section-number">12.2.6</span> Advanced data visualization</h3>
<p>Now that we have Mauna Loa, I want to add the Alert dataset to it using the code we developed last week. This code downloads the Alert dataset and renames its headers.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">URL.ALT.CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span> <span class="st">'https://gml.noaa.gov/aftp/data/trace_gases/ch4/flask/surface/txt/ch4_alt_surface-flask_1_ccgg_month.txt'</span><span class="op">)</span></span>
<span><span class="va">ALT.CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html">read_table</a></span><span class="op">(</span><span class="va">URL.ALT.CH4</span>, skip <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
── Column specification ────────────────────────────────────────────────────────
cols(
  ALT = col_character(),
  `1986` = col_double(),
  `10` = col_double(),
  `1774.13` = col_double()
)</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ALT.CH4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">headers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can put the datasets together to make a combined visualization. The <code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows()</a></code> function from <code>tidyverse</code> let’s us put the datasets take together since they have the same headers. Then we can use the <code>color</code> argument to <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> to get two separate time series as shown in <a href="#fig-bothTrend">Figure&nbsp;<span>12.7</span></a>. I also grouped the data by the shape of the symbol to ensure that the two datasets are distinguishable.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CH4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">ALT.CH4</span>, <span class="va">MLO.CH4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CH4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>decimal.Date <span class="op">=</span> <span class="op">(</span><span class="va">year</span> <span class="op">+</span> <span class="va">month</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">decimal.Date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">site</span>, shape <span class="op">=</span> <span class="va">site</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#geom_smooth(se = FALSE) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Year'</span>, y <span class="op">=</span> <span class="st">'Methane concentration (ppb)'</span>,</span>
<span>       title <span class="op">=</span> <span class="st">'Methane trend'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bothTrend" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="import2_files/figure-html/fig-bothTrend-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12.7: Trend in Methane concentrations (ppb) at Mauna Loa, Hawaii and Alert, Canada</figcaption></figure>
</div>
</div>
</div>
</section><section id="downloading-secured-zip-files" class="level3" data-number="12.2.7"><h3 data-number="12.2.7" class="anchored" data-anchor-id="downloading-secured-zip-files">
<span class="header-section-number">12.2.7</span> Downloading secured zip files</h3>
<p>I have not yet found a reliable method to get this to work every time on Macs and PCs. Stay tuned.</p>
</section></section><section id="exercise-1." class="level2" data-number="12.3"><h2 data-number="12.3" class="anchored" data-anchor-id="exercise-1.">
<span class="header-section-number">12.3</span> Exercise 1.</h2>
<ol type="1">
<li>Go to the <a href="https://experience.arcgis.com/experience/10788c3e860d489e9e8a63a2238bb63d">Environmental Justice Index</a> Accessibility Tool.<br>
</li>
<li>Pick a state from the dropdown menu.</li>
<li>Press the <strong>Apply</strong> button</li>
<li>An <strong>Actions</strong> button should appear; <span class="quarto-unresolved-ref">?fig-Action</span> shows where that is. Press the Actions button, select <em>Export All</em> and choose <strong>Export to geoJSON</strong>.</li>
</ol>
<p><img src=".\images/Action.png" id="fig-Action" class="img-fluid" alt="Action button"> 5. A file named <strong>DataRecords.geojson</strong> should appear in your default download folder. 6. Move the <strong>DataRecords.geojson</strong> file to the working directory. 7. Check the <em>Files</em> panel. Is <strong>DataRecords.geojson</strong> there?<br>
8. Read in the file using <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf()</a></code>. The <code>dsn</code> argument can point directly to the file name for this type of file. Assign it a name that incorporates EJI and the state abbreviation.<br>
9. Check the <em>Environment</em> panel. Did it import? 10. Make a visualization - but not a map because projections are wonky?</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CA_EJI_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">'DataRecords.geojson'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rpl_eji</span> <span class="op">&gt;=</span><span class="fl">0</span><span class="op">)</span> <span class="co">#%&gt;% </span></span>
<span></span>
<span><span class="co"># unfortunately, this data is in some weird projection that isn't properly identified but might be equal albers conformal conic</span></span>
<span><span class="co">#st_is_valid(CA_EJI_raw)</span></span>
<span><span class="co">#st_crs(CA_EJI_raw)</span></span>
<span></span>
<span><span class="va">CA_EJI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_set_geometry</a></span><span class="op">(</span><span class="va">CA_EJI_raw</span>, value <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">CA_EJI_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_set_crs</a></span><span class="op">(</span><span class="va">CA_EJI_raw</span>, </span>
<span>                         <span class="st">'+proj=aea +lat_0=37.5 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs +type=crs'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_crs&lt;- : replacing crs does not reproject data; use st_transform for
that</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">CA_EJI</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epl_rail</span>, y <span class="op">=</span> <span class="va">epl_dslpm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="import2_files/figure-html/EJI index for California-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">EJI index for California</figcaption></figure>
</div>
</div>
</div>
<p><span class="quarto-unresolved-ref">?fig-EJI_polygons</span> shows Diesel PM from their environmental indicators layer for San Bernardino County.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">CA_EJI_raw</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">epl_dslpm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Unit 3: Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./export.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exporting Visualizations and Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>